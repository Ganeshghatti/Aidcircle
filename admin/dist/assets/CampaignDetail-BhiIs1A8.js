import{r as c,k as T,j as a,l as I,o as A,s as $}from"./index-Bf73z5r4.js";import{R as U}from"./quill.snow-wHLeYI4R.js";import{I as M,E as R}from"./InputText-CYls1_pt.js";import{l as i,u as z}from"./Layout-HwrZM4zP.js";function F({id:h,label:u,value:d,setValue:P}){const N=c.useRef(),{link:j}=T(),f=localStorage.getItem("token"),[k,m]=c.useState(!1),t=b=>{const p=N.current.getEditor(),g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept","image/*"),g.click(),g.onchange=async()=>{const x=g.files[0];if(/^image\//.test(x.type)){console.log(x);const C=new FormData;C.append("image",x),m(!0);try{const E=(await I.post(`http://localhost:5000/admin/upload-campaign-image/${j}`,C,{headers:{Authorization:`Bearer ${f}`,"Content-Type":"multipart/form-data"}})).data.campaignImageUrl,y=p.getSelection();p.insertEmbed(y.index,"image",E),p.setSelection(y.index+1),p.insertText(y.index+1,`
`),i.NotificationManager.success("Success","Image Uploaded Successfully")}catch(w){console.log(w),i.NotificationManager.error("Error","Failed to update campaign",5e3,()=>{alert(w.response.data.error)})}finally{m(!1)}}}},o=["header","height","bold","italic","underline","strike","blockquote","list","color","bullet","indent","link","image","align","size"],v=c.useMemo(()=>({toolbar:{container:[[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],["link","image"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"},{align:[]}],[{color:["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466","custom-color"]}]],handlers:{image:t}}}),[]);return a.jsx(a.Fragment,{children:a.jsx(U,{theme:"snow",ref:N,value:d,modules:v,onChange:b=>P(b),formats:o})})}function L(){const h=A(),{link:u}=T(),d=localStorage.getItem("token"),[P,N]=c.useState([]),[j,f]=c.useState(!1),[k,m]=c.useState(""),[t,o]=c.useState({title:"",status:"",amount:0,beneficiaryName:"",content:"",thumbnail:"",thumbnailPreview:"",carouselImages:[],carouselPreviews:[]}),v=s=>{const e=document.createElement("div");e.innerHTML=s;const n=e.getElementsByTagName("img"),r=[];for(let l of n)r.push(l.src);return r},b=async()=>{try{if(d&&u){f(!0);const e=(await I.get(`http://localhost:5000/admin/get-campaign-details/${u}`,{headers:{Authorization:`Bearer ${d}`}})).data.campaign;o(r=>({...r,title:e.title,status:e.status,amount:e.amount,beneficiaryName:e.beneficiaryName,content:e.content,thumbnailPreview:e.thumbnail,carouselPreviews:e.carousel}));const n=v(e.content);N(n)}}catch(s){if(console.log(s),s.response&&s.response.status===401)return h("/");i.NotificationManager.error("Failed to fetch campaigns","Error",5e3,()=>{alert(s.response.data.error)})}finally{f(!1)}};c.useEffect(()=>{b()},[d]);const p=({updateType:s,value:e})=>{o({...t,[s]:e})},g=()=>{o(s=>({...s,status:s.status==="private"?"public":"private"}))},x=s=>{o(e=>({...e,amount:s}))},C=s=>{const e=s.target.files[0];o(n=>({...n,thumbnail:e,thumbnailPreview:URL.createObjectURL(e)}))},w=s=>{const e=Array.from(s.target.files),n=e.map(r=>URL.createObjectURL(r));o(r=>({...r,carouselImages:[...r.carouselImages,...e],carouselPreviews:[...r.carouselPreviews,...n]}))},E=s=>{o(e=>{const n=e.carouselImages.filter((l,S)=>S!==s),r=e.carouselPreviews.filter((l,S)=>S!==s);return{...e,carouselImages:n,carouselPreviews:r}})},y=async s=>{if(s.preventDefault(),m(""),!t.title||!t.status||!t.amount||!t.beneficiaryName||!t.thumbnailPreview||t.carouselPreviews.length===0){m("All fields are required."),i.NotificationManager.error("Error","All fields are required.");return}const e=v(t.content),n=P.filter(l=>!e.includes(l)),r=new FormData;r.append("title",t.title),r.append("status",t.status),r.append("amount",t.amount),r.append("beneficiaryName",t.beneficiaryName),r.append("content",t.content),t.thumbnail&&r.append("thumbnail",t.thumbnail);for(let l=0;l<t.carouselImages.length;l++)r.append("carouselImages",t.carouselImages[l]);n&&r.append("imagesToDelete",JSON.stringify(n));try{const l=await I.put(`http://localhost:5000/admin/update-campaign-details/${u}`,r,{headers:{Authorization:`Bearer ${d}`,"Content-Type":"multipart/form-data"}});i.NotificationManager.success("Success","Campaign Updated Successfully"),b()}catch(l){m(l.response.data.error),i.NotificationManager.error("Error","Failed to update campaign",5e3,()=>{alert(l.response.data.error)})}finally{f(!1)}},D=async s=>{if(s.preventDefault(),m(""),!u){i.NotificationManager.error("Error","Item couldn't be selected");return}if(!window.confirm("Are you sure you want to delete this campaign?"))return;const e=window.prompt("Please enter your password to confirm:");if(!e){i.NotificationManager.error("Error","Password is required to delete");return}try{f(!0);const n=await I.delete(`http://localhost:5000/admin/campaign-delete/${u}`,{headers:{Authorization:`Bearer ${d}`},data:{password:e}});i.NotificationManager.success("Success","Deleted Successfully"),h("/app/campaigns")}catch(n){m(n.response.data.error),i.NotificationManager.error("Error","Failed to delete the Specialty",5e3,()=>{alert(n.response.data.error)})}finally{f(!1)}};return a.jsxs(a.Fragment,{children:[a.jsx(i.NotificationContainer,{}),t&&t.title&&a.jsxs("div",{className:"w-full flex flex-col gap-8",children:[a.jsx(M,{type:"text",defaultValue:t.title,updateType:"title",containerStyle:"mt-4",labelTitle:"Enter Campaign Title",updateFormValue:p}),a.jsx(M,{type:"text",defaultValue:t.beneficiaryName,updateType:"beneficiaryName",labelTitle:"Enter Beneficiary Name",updateFormValue:p}),a.jsxs("label",{className:"label cursor-pointer flex justify-start gap-4 w-fit",children:[a.jsxs("span",{className:"label-text text-base-content",children:["Status: ",t.status]}),a.jsx("input",{type:"checkbox",className:"toggle",checked:t.status==="public",onChange:g})]}),a.jsx("input",{type:"number",value:t.amount,placeholder:"Enter Campaign Amount",onChange:s=>x(s.target.value),className:"input input-bordered w-full",style:{appearance:"textfield",MozAppearance:"textfield",MsAppearance:"textfield"}}),a.jsxs("div",{className:"form-control flex flex-col gap-2",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Upload Thumbnail Image"})})," ",a.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"input input-bordered w-full"})," ",t.thumbnailPreview&&a.jsx("div",{children:a.jsx("img",{src:t.thumbnailPreview,alt:"Thumbnail Preview",className:"w-1/5 h-auto mt-4"})})]}),a.jsxs("div",{className:"form-control flex flex-col gap-2",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Upload Carousel Images (1-5)"})})," ",a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:w,className:"input input-bordered w-full"}),t.carouselPreviews&&t.carouselPreviews.length>0&&a.jsx("div",{className:"w-full mt-4 flex flex-wrap gap-2",children:t.carouselPreviews.map((s,e)=>a.jsxs("div",{className:"relative flex w-1/3",children:[a.jsx("img",{src:s,alt:`Carousel Preview ${e+1}`,className:"border w-full h-auto"}),a.jsx("button",{className:"absolute top-0 right-0 bg-red-600 text-white rounded-full p-1",onClick:()=>E(e),children:"X"})]},e))})]}),a.jsx(F,{id:"description",name:"description",label:"Description",value:t.content,setValue:s=>o(e=>({...e,content:s}))}),a.jsx(R,{styleClass:"mt-8",children:k}),a.jsx("button",{type:"submit",onClick:y,className:"btn mt-2 w-full btn-primary"+(j?" loading":""),children:"Update"}),a.jsx("button",{onClick:D,className:"btn mt-6 w-full text-white bg-red-700"+(j?" loading":""),children:"Delete"})]})]})}function H(){const{link:h}=T(),u=z();return c.useEffect(()=>{u($({title:h}))},[]),a.jsx(L,{})}export{H as default};
