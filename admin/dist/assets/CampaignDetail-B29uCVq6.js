import{r as o,v as k,j as a,n as E,m as M,s as U}from"./index-vvvWIYqA.js";import{R as D}from"./quill.snow-CiPkw5_t.js";import{I as A}from"./InputText-yA2u88Bt.js";import{E as R}from"./ErrorText-DG8RsJKJ.js";import{l as m,u as $}from"./Layout-BwEjGXl_.js";function L({id:y,label:f,value:p,setValue:C}){const N=o.useRef(),{link:I}=k(),g=localStorage.getItem("token"),[S,d]=o.useState(!1),t=b=>{const c=N.current.getEditor(),u=document.createElement("input");u.setAttribute("type","file"),u.setAttribute("accept","image/*"),u.click(),u.onchange=async()=>{const h=u.files[0];if(/^image\//.test(h.type)){console.log(h);const j=new FormData;j.append("image",h),d(!0);try{const P=(await E.post(`http://localhost:5000/admin/upload-campaign-image/${I}`,j,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"multipart/form-data"}})).data.campaignImageUrl,w=c.getSelection();c.insertEmbed(w.index,"image",P),c.setSelection(w.index+1),c.insertText(w.index+1,`
`),m.NotificationManager.success("Success","Image Uploaded Successfully")}catch(x){console.log(x),m.NotificationManager.error("Error","Failed to update campaign",5e3,()=>{alert(x.response.data.error)})}finally{d(!1)}}}},r=["header","height","bold","italic","underline","strike","blockquote","list","color","bullet","indent","link","image","align","size"],v=o.useMemo(()=>({toolbar:{container:[[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"}],["link","image"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"},{align:[]}],[{color:["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466","custom-color"]}]],handlers:{image:t}}}),[]);return a.jsx(a.Fragment,{children:a.jsx(D,{theme:"snow",ref:N,value:p,modules:v,onChange:b=>C(b),formats:r})})}function z(){const y=M(),{link:f}=k(),p=localStorage.getItem("token"),[C,N]=o.useState([]),[I,g]=o.useState(!1),[S,d]=o.useState(""),[t,r]=o.useState({title:"",status:"",amount:0,beneficiaryName:"",content:"",thumbnail:"",thumbnailPreview:"",carouselImages:[],carouselPreviews:[]}),v=s=>{const e=document.createElement("div");e.innerHTML=s;const i=e.getElementsByTagName("img"),n=[];for(let l of i)n.push(l.src);return n},b=async()=>{try{if(p&&f){g(!0);const e=(await E.get(`http://localhost:5000/admin/get-campaign-details/${f}`,{headers:{Authorization:`Bearer ${p}`}})).data.campaign;r(n=>({...n,title:e.title,status:e.status,amount:e.amount,beneficiaryName:e.beneficiaryName,content:e.content,thumbnailPreview:e.thumbnail,carouselPreviews:e.carousel}));const i=v(e.content);N(i)}}catch(s){if(console.log(s),s.response&&s.response.status===401)return y("/");m.NotificationManager.error("Failed to fetch campaigns","Error",5e3,()=>{alert(s.response.data.error)})}finally{g(!1)}};o.useEffect(()=>{b()},[p]);const c=({updateType:s,value:e})=>{r({...t,[s]:e})},u=()=>{r(s=>({...s,status:s.status==="private"?"public":"private"}))},h=s=>{r(e=>({...e,amount:s}))},j=s=>{const e=s.target.files[0];r(i=>({...i,thumbnail:e,thumbnailPreview:URL.createObjectURL(e)}))},x=s=>{const e=Array.from(s.target.files),i=e.map(n=>URL.createObjectURL(n));r(n=>({...n,carouselImages:[...n.carouselImages,...e],carouselPreviews:[...n.carouselPreviews,...i]}))},P=s=>{r(e=>{const i=e.carouselImages.filter((l,T)=>T!==s),n=e.carouselPreviews.filter((l,T)=>T!==s);return{...e,carouselImages:i,carouselPreviews:n}})},w=async s=>{if(s.preventDefault(),d(""),!t.title||!t.status||!t.amount||!t.beneficiaryName||!t.thumbnailPreview||t.carouselPreviews.length===0){d("All fields are required."),m.NotificationManager.error("Error","All fields are required.");return}const e=v(t.content),i=C.filter(l=>!e.includes(l)),n=new FormData;n.append("title",t.title),n.append("status",t.status),n.append("amount",t.amount),n.append("beneficiaryName",t.beneficiaryName),n.append("content",t.content),t.thumbnail&&n.append("thumbnail",t.thumbnail);for(let l=0;l<t.carouselImages.length;l++)n.append("carouselImages",t.carouselImages[l]);i&&n.append("imagesToDelete",JSON.stringify(i));try{const l=await E.put(`http://localhost:5000/admin/update-campaign-details/${f}`,n,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"multipart/form-data"}});m.NotificationManager.success("Success","Campaign Updated Successfully"),b()}catch(l){d(l.response.data.error),m.NotificationManager.error("Error","Failed to update campaign",5e3,()=>{alert(l.response.data.error)})}finally{g(!1)}};return a.jsxs(a.Fragment,{children:[a.jsx(m.NotificationContainer,{}),t&&t.title&&a.jsxs("div",{className:"w-full flex flex-col gap-8",children:[a.jsx(A,{type:"text",defaultValue:t.title,updateType:"title",containerStyle:"mt-4",labelTitle:"Enter Campaign Title",updateFormValue:c}),a.jsx(A,{type:"text",defaultValue:t.beneficiaryName,updateType:"beneficiaryName",labelTitle:"Enter Beneficiary Name",updateFormValue:c}),a.jsxs("label",{className:"label cursor-pointer flex justify-start gap-4 w-fit",children:[a.jsxs("span",{className:"label-text text-base-content",children:["Status: ",t.status]}),a.jsx("input",{type:"checkbox",className:"toggle",checked:t.status==="public",onChange:u})]}),a.jsx("input",{type:"number",value:t.amount,placeholder:"Enter Campaign Amount",onChange:s=>h(s.target.value),className:"input input-bordered w-full",style:{appearance:"textfield",MozAppearance:"textfield",MsAppearance:"textfield"}}),a.jsxs("div",{className:"form-control flex flex-col gap-2",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Upload Thumbnail Image"})})," ",a.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"input input-bordered w-full"})," ",t.thumbnailPreview&&a.jsx("div",{children:a.jsx("img",{src:t.thumbnailPreview,alt:"Thumbnail Preview",className:"w-1/5 h-auto mt-4"})})]}),a.jsxs("div",{className:"form-control flex flex-col gap-2",children:[a.jsx("label",{className:"label",children:a.jsx("span",{className:"label-text",children:"Upload Carousel Images (1-5)"})})," ",a.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:x,className:"input input-bordered w-full"}),t.carouselPreviews&&t.carouselPreviews.length>0&&a.jsx("div",{className:"w-full mt-4 flex flex-wrap gap-2",children:t.carouselPreviews.map((s,e)=>a.jsxs("div",{className:"relative flex w-1/3",children:[a.jsx("img",{src:s,alt:`Carousel Preview ${e+1}`,className:"border w-full h-auto"}),a.jsx("button",{className:"absolute top-0 right-0 bg-red-600 text-white rounded-full p-1",onClick:()=>P(e),children:"X"})]},e))})]}),a.jsx(L,{id:"description",name:"description",label:"Description",value:t.content,setValue:s=>r(e=>({...e,content:s}))}),a.jsx(R,{styleClass:"mt-8",children:S}),a.jsx("button",{type:"submit",onClick:w,className:"btn mt-2 w-full btn-primary"+(I?" loading":""),children:"Update"})]})]})}function H(){const{link:y}=k(),f=$();return o.useEffect(()=>{f(U({title:y}))},[]),a.jsx(z,{})}export{H as default};
